editor v8.html
<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Power Editor Pro (Stable)</title>

<!--
==================================================
  Power Editor
  ------------------------------------------------
  Version      : 1.0 (Stable)
  Codename     : Genesis
  Channel      : Isolated Sandbox Editor

  Author       : latib kanafi
  Created      : 2026-02-07
  Last Update  : 2026-02-07

  Description  :
  ------------------------------------------------
  Power Editor adalah editor ringan berbasis web
  dengan eksekusi kode terisolasi (sandbox).
  Dirancang untuk eksplorasi, pembelajaran,
  dan pengujian logika tanpa efek samping global.

  Core Principles :
  ------------------------------------------------
  1. Single File Architecture
  2. Global Scope Isolation
  3. Explicit Execution Control
  4. Human-Readable Logic
  5. No Hidden Side Effects

  Notes :
  ------------------------------------------------
  - Semua fitur baru wajib dicatat dengan
    tanggal & waktu penambahan.
  - Tidak ada dependensi eksternal.
  - Fokus pada kejelasan, bukan kecepatan.

==================================================
-->


<style>
/* =================================================
   BASE LAYOUT (FIXED)
   Added: 2026-02-07 15:40
   ================================================= */
html, body {
    margin: 0;
    height: 100%;
    overflow: hidden;
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: #1e1e1e;
}

body {
    display: flex;
    flex-direction: column;
}

/* =================================================
   TOOLBAR
   ================================================= */
#toolbar {
    height: 55px;
    padding: 10px;
    background: #1e1e1e;
    display: flex;
    gap: 10px;
    align-items: center;
    border-bottom: 1px solid #333;
    color: white;
}

#toolbar button {
    padding: 6px 15px;
    background: #333;
    border: 1px solid #555;
    color: white;
    cursor: pointer;
    border-radius: 4px;
}

#toolbar button:hover {
    background: #444;
    border-color: #007acc;
}

.btn-new {
    background: #007acc;
}

/* =================================================
   MAIN AREA (EDITOR + CONSOLE)
   ================================================= */
#main {
    flex: 1;
    display: flex;
    flex-direction: column;
}

#editor {
    flex: 1;
}

/* =================================================
   CONSOLE PANEL
   Added: 2026-02-07 14:10
   ================================================= */
#console {
    height: 160px;
    background: #111;
    border-top: 1px solid #333;
    display: flex;
    flex-direction: column;
}

#console-header {
    background: #1e1e1e;
    padding: 6px 10px;
    font-size: 13px;
    color: #ccc;
    display: flex;
    justify-content: space-between;
}

#console-body {
    flex: 1;
    margin: 0;
    padding: 8px;
    overflow-y: auto;
    font-family: monospace;
    font-size: 13px;
    white-space: pre-wrap;
}

.log   { color: #0f0; }
.warn  { color: #ff0; }
.error { color: #f55; cursor: pointer; }
</style>
</head>

<body>

<div id="toolbar">
    <button class="btn-new" onclick="newFile()">üìÑ New</button>
    <button onclick="saveFile()">üíæ Save</button>
    <button onclick="preview()">üëÅÔ∏è Preview</button>
</div>

<div id="main">
    <div id="editor"></div>

    <div id="console">
        <div id="console-header">
            üß™ Console
            <button onclick="clearConsole()">Clear</button>
        </div>
        <pre id="console-body"></pre>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
<script>
/* =================================================
   MONACO INIT (FIXED)
   ================================================= */
let editor;
let previewWindow = null;

const TEMPLATE = `<!DOCTYPE html>
<html>
<body>

<script>
console.log("Editor siap.");
</script>

</body>
</html>`;

require.config({
    paths: { vs: "https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs" }
});

require(["vs/editor/editor.main"], function () {
    editor = monaco.editor.create(
        document.getElementById("editor"),
        {
            value: localStorage.getItem("saved_code") || TEMPLATE,
            language: "html",
            theme: "vs-dark",
            automaticLayout: true,
            minimap: { enabled: false },
            fontSize: 14
        }
    );

    editor.onDidChangeModelContent(() => {
        localStorage.setItem("saved_code", editor.getValue());
    });
});

/* =================================================
   FILE OPS (FIXED)
   ================================================= */
function newFile() {
    if (!editor) return;
    editor.setValue(TEMPLATE);
}

function saveFile() {
    const blob = new Blob([editor.getValue()], { type: "text/html" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "index.html";
    a.click();
}

/* =================================================
   CONSOLE CORE
   ================================================= */
function logToConsole(type, message, line) {
    const body = document.getElementById("console-body");
    const time = new Date().toLocaleTimeString();
    const span = document.createElement("span");

    span.className = type;
    span.textContent = `[${time}] [${type}] ${message}\n`;

    if (type === "error" && line) {
        span.onclick = () => {
            editor.revealLineInCenter(line);
            editor.setPosition({ lineNumber: line, column: 1 });
            editor.focus();
        };
    }

    body.appendChild(span);
    body.scrollTop = body.scrollHeight;
}

function clearConsole() {
    document.getElementById("console-body").textContent = "";
}

/* =================================================
   PREVIEW (CORRECT ISOLATION)
   ================================================= */
function preview() {
    if (!previewWindow || previewWindow.closed) {
        previewWindow = window.open();
    }

    const userHTML = editor.getValue();

    const consoleHook = `
<script>
(function(){
    function send(type, msg, line){
        window.opener.postMessage({ type, msg, line }, "*");
    }

    ["log","warn","error"].forEach(t=>{
        const old = console[t];
        console[t] = function(...a){
            old.apply(console,a);
            send(t, a.join(" "));
        };
    });

    window.onerror = function(msg, src, line){
        send("error", msg, line);
    };

    window.onunhandledrejection = function(e){
        send("error", String(e.reason), null);
    };
})();
</script>
`;

    previewWindow.document.open();
    previewWindow.document.write(
        userHTML.replace("</body>", consoleHook + "</body>")
    );
    previewWindow.document.close();
}

/* =================================================
   MESSAGE BRIDGE
   ================================================= */
window.addEventListener("message", e => {
    if (!e.data) return;
    logToConsole(e.data.type, e.data.msg, e.data.line);
});
</script>

</body>
</html>
